---
- name: configure trusted domain
  become: yes
  become_user: www-data
  become_method: sudo
  args:
    chdir: "/var/www/owncloud/"
  ansible.builtin.shell: |
    ./occ config:system:set trusted_domains 0 --value "{{ owncloud_config.vhost.domains.main }}"

- name: configure webroot for urls generated by scripts
  become: yes
  become_user: www-data
  become_method: sudo
  args:
    chdir: "/var/www/owncloud/"
  ansible.builtin.shell: |
    ./occ config:system:set overwrite.cli.url --value "{{ 'https' if owncloud_config.vhost.ssl else 'http' }}://{{ owncloud_config.vhost.domains.main }}"

- name: configure mail domain
  become: yes
  become_user: www-data
  become_method: sudo
  args:
    chdir: "/var/www/owncloud/"
  ansible.builtin.shell: |
    ./occ config:system:set mail_domain --value "{{ owncloud_config.vhost.domains.main }}"

- name: configure logs
  become: yes
  become_user: www-data
  become_method: sudo
  args:
    chdir: "/var/www/owncloud/"
  ansible.builtin.shell: |
    ./occ config:system:set logfile --value "/var/log/owncloud/"

- name: configure memory cache
  become: yes
  become_user: www-data
  become_method: sudo
  args:
    chdir: "/var/www/owncloud/"
  ansible.builtin.shell: |
    ./occ config:system:set memcache.local --value "\OC\Memcache\APCu"

- name: configure cron jobs
  ansible.builtin.cron:
    name: owncloud:system:cron
    job: /usr/bin/php -f /var/www/owncloud/occ system:cron
    user: www-data
