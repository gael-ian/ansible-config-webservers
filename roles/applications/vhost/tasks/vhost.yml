---
- name: Create nginx vhost file
  template:
    src: "vhosts/{{ vhost.type }}.conf.j2"
    dest: "{{ nginx.vhost }}"
    owner: root
    group: root
    mode: 0644
  notify:
    - reload nginx

- name: Enable nginx vhost
  file:
    state: link
    src: "{{ nginx.vhost }}"
    dest: "/etc/nginx/sites-enabled/{{ nginx.vhost | basename }}"
    owner: root
    group: root
    mode: 0644
  notify:
    - reload nginx
