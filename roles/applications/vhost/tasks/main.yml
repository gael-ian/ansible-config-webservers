---

- name: compile variables
  include_tasks: 01-compile-vars.yml

- name: create directories
  file:
    state: directory
    path:  "{{ dir.value.path }}"
    owner: "{{ dir.value.owner }}"
    group: "{{ dir.value.group }}"
    mode:  "{{ dir.value.mode }}"
  with_dict: "{{ directories }}"
  loop_control:
    loop_var: dir

- name: configure vhost
  include_tasks: 02-vhost.yml

- name: configure PHP pool
  include_role:
    name: php-fpm-pool
    private: True
  vars:
    php_fpm_pool: "{{ vhost.upstream | combine({ 'user': user, 'group': 'applications' }) }}"
  when: '"upstream" in vhost'

- name: configure SSL certificate
  include_tasks: 03-ssl.yml
  when: ssl

- name: configure logs
  include_tasks: 04-logs.yml
